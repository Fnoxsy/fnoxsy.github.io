<!doctype html>
<html lang="ru">
 <head>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();
</script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DarkPay - Secure Digital Marketplace</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0a0f;
      color: #e0e0e0;
      overflow-x: hidden;
      position: relative;
    }

    * {
      box-sizing: border-box;
    }

    .snowflake {
      position: fixed;
      top: -10px;
      z-index: 9999;
      user-select: none;
      cursor: default;
      animation-name: snowfall;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      color: rgba(255, 255, 255, 0.8);
      font-size: 1em;
      pointer-events: none;
    }

    @keyframes snowfall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0.3;
      }
    }

    /* Header */
    .header {
      background: rgba(15, 15, 25, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(139, 92, 246, 0.2);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: #8b5cf6;
    }

    .logo-icon {
      width: 2rem;
      height: 2rem;
    }

    .nav {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    .nav-link {
      color: #a0a0a0;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
      cursor: pointer;
    }

    .nav-link:hover {
      color: #8b5cf6;
    }

    .btn-primary {
      background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
    }

    /* Hero Section */
    .hero {
      padding: 4rem 2rem;
      text-align: center;
      background: linear-gradient(180deg, rgba(139, 92, 246, 0.1) 0%, transparent 100%);
    }

    .hero-content {
      max-width: 900px;
      margin: 0 auto;
    }

    .hero h1 {
      font-size: 3rem;
      margin: 0 0 1rem 0;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      font-size: 1.25rem;
      color: #a0a0a0;
      margin-bottom: 2rem;
    }

    .search-bar {
      max-width: 600px;
      margin: 0 auto 3rem auto;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 1rem 3rem 1rem 1.5rem;
      background: rgba(30, 30, 45, 0.8);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 0.75rem;
      color: #e0e0e0;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.3s;
    }

    .search-input:focus {
      border-color: #8b5cf6;
    }

    .search-icon {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #8b5cf6;
    }

    /* Categories */
    .categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    .category-card {
      background: rgba(30, 30, 45, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 0.75rem;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .category-card:hover {
      background: rgba(139, 92, 246, 0.1);
      border-color: #8b5cf6;
      transform: translateY(-5px);
    }

    .category-icon {
      width: 3rem;
      height: 3rem;
      margin: 0 auto 0.75rem auto;
      color: #8b5cf6;
    }

    .category-name {
      font-weight: 600;
      color: #e0e0e0;
    }

    .role-badge {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 700;
      margin-left: 0.5rem;
    }

    .page-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      min-height: 60%;
    }

    .page-title {
      font-size: 2.5rem;
      margin-bottom: 2rem;
      color: #e0e0e0;
    }

    .sellers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .seller-card {
      background: rgba(30, 30, 45, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 0.75rem;
      padding: 1.5rem;
      transition: all 0.3s;
    }

    .seller-card:hover {
      border-color: #8b5cf6;
      transform: translateY(-5px);
    }

    .seller-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .seller-avatar {
      width: 3rem;
      height: 3rem;
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .seller-info h3 {
      margin: 0;
      color: #e0e0e0;
    }

    .seller-stats {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #a0a0a0;
    }

    .support-form {
      max-width: 600px;
      margin: 2rem auto;
    }

    .ticket-list {
      margin-top: 2rem;
    }

    .ticket-card {
      background: rgba(30, 30, 45, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .ticket-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .ticket-status {
      padding: 0.25rem 0.75rem;
      border-radius: 0.25rem;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .ticket-status.open {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
    }

    .ticket-status.under_review {
      background: rgba(59, 130, 246, 0.2);
      color: #3b82f6;
    }

    .ticket-status.reviewed {
      background: rgba(139, 92, 246, 0.2);
      color: #8b5cf6;
    }

    .ticket-status.rejected {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .ticket-status.fixed {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .ticket-status.closed {
      background: rgba(107, 114, 128, 0.2);
      color: #6b7280;
    }

    .add-product-btn {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 3.5rem;
      height: 3.5rem;
      border-radius: 50%;
      background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
      color: white;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
      transition: transform 0.2s;
      z-index: 99;
    }

    .add-product-btn:hover {
      transform: scale(1.1);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .btn-success:hover {
      transform: translateY(-2px);
    }

    .product-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .btn-small {
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
    }

    /* Products Section */
    .products-section {
      padding: 4rem 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    .section-title {
      font-size: 2rem;
      margin-bottom: 2rem;
      color: #e0e0e0;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
    }

    .product-card {
      background: rgba(30, 30, 45, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 0.75rem;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
    }

    .product-card:hover {
      transform: translateY(-5px);
      border-color: #8b5cf6;
      box-shadow: 0 10px 30px rgba(139, 92, 246, 0.2);
    }

    .product-image {
      width: 100%;
      height: 180px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(236, 72, 153, 0.3) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
    }

    .product-info {
      padding: 1.25rem;
    }

    .product-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #e0e0e0;
    }

    .product-seller {
      font-size: 0.9rem;
      color: #8b5cf6;
      margin-bottom: 0.75rem;
    }

    .product-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .product-price {
      font-size: 1.25rem;
      font-weight: 700;
      color: #10b981;
    }

    .product-rating {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      color: #fbbf24;
    }

    /* Features Section */
    .features {
      padding: 4rem 2rem;
      background: rgba(139, 92, 246, 0.05);
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    .feature-card {
      text-align: center;
      padding: 2rem;
    }

    .feature-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .feature-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #e0e0e0;
    }

    .feature-desc {
      color: #a0a0a0;
    }

    /* Footer */
    .footer {
      background: rgba(15, 15, 25, 0.95);
      border-top: 1px solid rgba(139, 92, 246, 0.2);
      padding: 3rem 2rem 1.5rem 2rem;
      margin-top: 4rem;
    }

    .footer-content {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .footer-section h3 {
      color: #8b5cf6;
      margin-bottom: 1rem;
    }

    .footer-link {
      display: block;
      color: #a0a0a0;
      text-decoration: none;
      margin-bottom: 0.5rem;
      transition: color 0.3s;
    }

    .footer-link:hover {
      color: #8b5cf6;
    }

    .footer-bottom {
      text-align: center;
      padding-top: 2rem;
      border-top: 1px solid rgba(139, 92, 246, 0.2);
      color: #a0a0a0;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: rgba(30, 30, 45, 0.95);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      position: relative;
      max-height: 90%;
      overflow-y: auto;
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: #a0a0a0;
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.3s;
    }

    .modal-close:hover {
      color: #8b5cf6;
    }

    .modal-title {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      color: #e0e0e0;
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      color: #a0a0a0;
      font-size: 0.9rem;
    }

    .form-input {
      width: 100%;
      padding: 0.75rem;
      background: rgba(15, 15, 25, 0.8);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 0.5rem;
      color: #e0e0e0;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.3s;
    }

    .form-input:focus {
      border-color: #8b5cf6;
    }

    .btn-full {
      width: 100%;
      padding: 0.875rem;
      margin-top: 0.5rem;
    }

    .user-menu {
      position: relative;
    }

    .user-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(139, 92, 246, 0.2);
      border: 1px solid rgba(139, 92, 246, 0.3);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      color: #e0e0e0;
      cursor: pointer;
      transition: all 0.3s;
    }

    .user-button:hover {
      background: rgba(139, 92, 246, 0.3);
    }

    .dropdown {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.5rem;
      background: rgba(30, 30, 45, 0.95);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 0.5rem;
      min-width: 200px;
      overflow: hidden;
    }

    .dropdown.active {
      display: block;
    }

    .dropdown-item {
      padding: 0.75rem 1rem;
      color: #e0e0e0;
      cursor: pointer;
      transition: background 0.3s;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
    }

    .dropdown-item:hover {
      background: rgba(139, 92, 246, 0.2);
    }

    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: rgba(139, 92, 246, 0.95);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 2000;
      display: none;
      animation: slideIn 0.3s ease;
    }

    .toast.active {
      display: block;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .users-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2rem;
    }

    .users-table th,
    .users-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid rgba(139, 92, 246, 0.2);
    }

    .users-table th {
      background: rgba(139, 92, 246, 0.1);
      color: #8b5cf6;
      font-weight: 600;
    }

    .users-table tr:hover {
      background: rgba(139, 92, 246, 0.05);
    }

    .role-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 2rem;
    }

    .role-card {
      background: rgba(30, 30, 45, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 0.75rem;
      padding: 1.5rem;
    }

    .role-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .permissions-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .permissions-list li {
      padding: 0.5rem 0;
      color: #a0a0a0;
      font-size: 0.9rem;
    }

    .chat-container {
      background: rgba(30, 30, 45, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-top: 1rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .chat-message {
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: rgba(15, 15, 25, 0.6);
      border-radius: 0.5rem;
    }

    .chat-message.admin {
      background: rgba(139, 92, 246, 0.1);
      border-left: 3px solid #8b5cf6;
    }

    .chat-message-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 0.85rem;
      color: #a0a0a0;
    }

    .chat-message-body {
      color: #e0e0e0;
    }

    .balance-display {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      padding: 1rem;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
    }

    .balance-amount {
      font-size: 2rem;
      font-weight: 700;
      color: #10b981;
    }

    .transaction-list {
      margin-top: 1rem;
    }

    .transaction-item {
      display: flex;
      justify-content: space-between;
      padding: 0.75rem;
      background: rgba(30, 30, 45, 0.6);
      border-radius: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .transaction-item.income {
      border-left: 3px solid #10b981;
    }

    .transaction-item.expense {
      border-left: 3px solid #ef4444;
    }

    .settings-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .settings-section {
      background: rgba(30, 30, 45, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 0.75rem;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .settings-section h2 {
      color: #8b5cf6;
      margin: 0 0 1.5rem 0;
      font-size: 1.5rem;
    }

    .gradient-preview {
      width: 100%;
      height: 150px;
      border-radius: 0.75rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }

    .color-picker-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .color-picker-item {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .color-picker-item label {
      color: #a0a0a0;
      font-size: 0.9rem;
    }

    .color-picker-item input[type="color"] {
      width: 100%;
      height: 50px;
      border: 2px solid rgba(139, 92, 246, 0.3);
      border-radius: 0.5rem;
      cursor: pointer;
      background: transparent;
    }

    .gradient-type-selector {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .gradient-type-btn {
      padding: 0.75rem 1.5rem;
      background: rgba(30, 30, 45, 0.8);
      border: 2px solid rgba(139, 92, 246, 0.3);
      border-radius: 0.5rem;
      color: #e0e0e0;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .gradient-type-btn.active {
      background: rgba(139, 92, 246, 0.3);
      border-color: #8b5cf6;
      color: #8b5cf6;
    }

    .gradient-type-btn:hover {
      border-color: #8b5cf6;
    }

    .slider-group {
      margin-bottom: 1.5rem;
    }

    .slider-group label {
      display: block;
      color: #a0a0a0;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .slider-group input[type="range"] {
      width: 100%;
      height: 8px;
      border-radius: 5px;
      background: rgba(139, 92, 246, 0.2);
      outline: none;
      -webkit-appearance: none;
    }

    .slider-group input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #8b5cf6;
      cursor: pointer;
    }

    .slider-group input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #8b5cf6;
      cursor: pointer;
      border: none;
    }

    .slider-value {
      display: inline-block;
      margin-left: 1rem;
      color: #8b5cf6;
      font-weight: 600;
    }

    .effect-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: rgba(15, 15, 25, 0.6);
      border-radius: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .effect-toggle label {
      color: #e0e0e0;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(107, 114, 128, 0.5);
      transition: 0.4s;
      border-radius: 34px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
      background-color: #8b5cf6;
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(24px);
    }

    .preset-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .preset-btn {
      padding: 1rem;
      border-radius: 0.75rem;
      border: 2px solid rgba(139, 92, 246, 0.3);
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      font-weight: 600;
      color: white;
    }

    .preset-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    .permission-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }

    .permission-card {
      background: rgba(15, 15, 25, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 0.5rem;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .permission-info {
      flex: 1;
    }

    .permission-name {
      color: #e0e0e0;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .permission-desc {
      color: #a0a0a0;
      font-size: 0.85rem;
    }

    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2rem;
      }

      .nav {
        gap: 1rem;
      }

      .categories {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }

      .color-picker-group {
        grid-template-columns: 1fr;
      }

      .preset-buttons {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- Header -->
  <header class="header">
   <div class="header-content">
    <div class="logo">
     <svg class="logo-icon" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor" opacity="0.3" /> <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /> <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
     </svg><span id="site-title">DarkPay</span>
    </div>
    <nav class="nav"><a class="nav-link" onclick="showPage('home')">–ö–∞—Ç–∞–ª–æ–≥</a> <a class="nav-link" onclick="showPage('sellers')">–ü—Ä–æ–¥–∞–≤—Ü—ã</a> <a class="nav-link" onclick="showPage('support')">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a> <a class="nav-link" id="users-nav-link" style="display: none;" onclick="showPage('users')">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a> <a class="nav-link" id="settings-nav-link" style="display: none;" onclick="showPage('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
     <div id="auth-container"></div>
    </nav>
   </div>
  </header><!-- Hero Section -->
  <section class="hero">
   <div class="hero-content">
    <h1 id="hero-title">–ü–æ–∫—É–ø–∞–π –∏ –ø—Ä–æ–¥–∞–≤–∞–π —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã</h1>
    <p id="hero-subtitle">–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –¥–ª—è –∏–≥—Ä–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —É—Å–ª—É–≥</p>
    <div class="search-bar"><input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤, –∏–≥—Ä, —É—Å–ª—É–≥...">
     <svg class="search-icon" width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle> <path d="m21 21-4.35-4.35" />
     </svg>
    </div><button class="btn-primary" id="cta-button" style="font-size: 1.1rem; padding: 1rem 2rem;">–ù–∞—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é</button>
   </div>
  </section><!-- Main Content Container -->
  <div id="main-content"><!-- Home Page -->
   <div id="home-page"><!-- Categories -->
    <section style="padding: 3rem 0;">
     <div class="categories">
      <div class="category-card" data-category="accounts">
       <svg class="category-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect> <polyline points="17 2 12 7 7 2"></polyline>
       </svg>
       <div class="category-name">
        –ò–≥—Ä–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
       </div>
      </div>
      <div class="category-card" data-category="currency">
       <svg class="category-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
       </svg>
       <div class="category-name">
        –í–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞
       </div>
      </div>
      <div class="category-card" data-category="items">
       <svg class="category-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6.5 6.5l11 11M6.5 17.5l11-11M12 2L2 7l10 5 10-5-10-5z" />
       </svg>
       <div class="category-name">
        –ü—Ä–µ–¥–º–µ—Ç—ã
       </div>
      </div>
      <div class="category-card" data-category="boost">
       <svg class="category-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
       </svg>
       <div class="category-name">
        –ë—É—Å—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞
       </div>
      </div>
      <div class="category-card" data-category="skins">
       <svg class="category-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" /> <line x1="7" y1="7" x2="7.01" y2="7"></line>
       </svg>
       <div class="category-name">
        –°–∫–∏–Ω—ã
       </div>
      </div>
      <div class="category-card" data-category="services">
       <svg class="category-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle> <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24" />
       </svg>
       <div class="category-name">
        –£—Å–ª—É–≥–∏
       </div>
      </div>
     </div>
    </section><!-- Products Section -->
    <section class="products-section">
     <h2 class="section-title">üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h2>
     <div class="products-grid"></div>
    </section><!-- Features Section -->
    <section class="features">
     <div class="features-grid">
      <div class="feature-card">
       <svg class="feature-icon" style="width: 3rem; height: 3rem; margin: 0 auto 1rem; color: #8b5cf6;" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect> <path d="M7 11V7a5 5 0 0 1 10 0v4" />
       </svg>
       <div class="feature-title">
        –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–¥–µ–ª–∫–∏
       </div>
       <div class="feature-desc">
        –ó–∞—â–∏—Ç–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –∏ –ø—Ä–æ–¥–∞–≤—Ü–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
       </div>
      </div>
      <div class="feature-card">
       <svg class="feature-icon" style="width: 3rem; height: 3rem; margin: 0 auto 1rem; color: #8b5cf6;" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
       </svg>
       <div class="feature-title">
        –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
       </div>
       <div class="feature-desc">
        –ü–æ–ª—É—á–∞–π—Ç–µ —Ç–æ–≤–∞—Ä—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
       </div>
      </div>
      <div class="feature-card">
       <svg class="feature-icon" style="width: 3rem; height: 3rem; margin: 0 auto 1rem; color: #8b5cf6;" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
       </svg>
       <div class="feature-title">
        –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7
       </div>
       <div class="feature-desc">
        –í—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å —Ä–µ—à–∏—Ç—å –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å
       </div>
      </div>
      <div class="feature-card">
       <svg class="feature-icon" style="width: 3rem; height: 3rem; margin: 0 auto 1rem; color: #8b5cf6;" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /> <polyline points="22 4 12 14.01 9 11.01"></polyline>
       </svg>
       <div class="feature-title">
        –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–≤—Ü—ã
       </div>
       <div class="feature-desc">
        –°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –∏ –æ—Ç–∑—ã–≤–æ–≤
       </div>
      </div>
     </div>
    </section>
   </div><!-- Sellers Page -->
   <div id="sellers-page" style="display: none;">
    <div class="page-container">
     <h1 class="page-title">–ü—Ä–æ–¥–∞–≤—Ü—ã</h1>
     <div class="sellers-grid" id="sellers-grid"></div>
    </div>
   </div><!-- Support Page -->
   <div id="support-page" style="display: none;">
    <div class="page-container">
     <h1 class="page-title">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h1>
     <div class="support-form">
      <form id="support-form" onsubmit="submitTicket(event)">
       <div class="form-group"><label class="form-label" for="ticket-subject">–¢–µ–º–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è</label> <input type="text" id="ticket-subject" class="form-input" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∫—Ä–∞—Ç–∫–æ" required>
       </div>
       <div class="form-group"><label class="form-label" for="ticket-message">–°–æ–æ–±—â–µ–Ω–∏–µ</label> <textarea id="ticket-message" class="form-input" rows="5" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É" required></textarea>
       </div><button type="submit" class="btn-primary btn-full">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ</button>
      </form>
     </div>
     <div class="ticket-list" id="ticket-list"></div>
    </div>
   </div><!-- Users Page (Admin Only) -->
   <div id="users-page" style="display: none;">
    <div class="page-container">
     <h1 class="page-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
     <h2 style="color: #8b5cf6; margin-bottom: 1rem;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
     <table class="users-table">
      <thead>
       <tr>
        <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
        <th>–†–æ–ª—å</th>
        <th>–ë–∞–ª–∞–Ω—Å</th>
        <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
       </tr>
      </thead>
      <tbody id="users-table-body"></tbody>
     </table>
     <h2 style="color: #8b5cf6; margin-top: 3rem; margin-bottom: 1rem;">–†–æ–ª–∏</h2>
     <div style="margin-bottom: 2rem;"><button class="btn-primary" onclick="openCreateRoleModal()">–°–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å</button>
     </div>
     <div class="role-list" id="role-list"></div>
    </div>
   </div><!-- Profile Page -->
   <div id="profile-page" style="display: none;">
    <div class="page-container">
     <h1 class="page-title">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
     <div class="balance-display">
      <div style="color: #a0a0a0; margin-bottom: 0.5rem;">
       –ë–∞–ª–∞–Ω—Å
      </div>
      <div class="balance-amount" id="profile-balance">
       $0.00
      </div><button class="btn-success" style="margin-top: 1rem;" onclick="openTopUpModal()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
     </div>
     <h2 style="color: #8b5cf6; margin-top: 2rem; margin-bottom: 1rem;">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h2>
     <div class="transaction-list" id="transaction-list"></div>
     <h2 style="color: #8b5cf6; margin-top: 2rem; margin-bottom: 1rem;">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</h2>
     <div class="products-grid" id="my-purchases"></div>
    </div>
   </div><!-- Settings Page -->
   <div id="settings-page" style="display: none;">
    <div class="settings-container">
     <h1 class="page-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</h1><!-- Gradient Settings -->
     <div class="settings-section">
      <h2>üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤</h2>
      <div class="gradient-preview" id="gradient-preview">
       DarkPay
      </div>
      <div class="gradient-type-selector"><button class="gradient-type-btn active" onclick="setGradientType('linear')">–õ–∏–Ω–µ–π–Ω—ã–π</button> <button class="gradient-type-btn" onclick="setGradientType('radial')">–†–∞–¥–∏–∞–ª—å–Ω—ã–π</button> <button class="gradient-type-btn" onclick="setGradientType('conic')">–ö–æ–Ω–∏—á–µ—Å–∫–∏–π</button>
      </div>
      <div class="color-picker-group">
       <div class="color-picker-item"><label>–¶–≤–µ—Ç 1</label> <input type="color" id="gradient-color1" value="#8b5cf6" oninput="updateGradient()">
       </div>
       <div class="color-picker-item"><label>–¶–≤–µ—Ç 2</label> <input type="color" id="gradient-color2" value="#ec4899" oninput="updateGradient()">
       </div>
       <div class="color-picker-item"><label>–¶–≤–µ—Ç 3</label> <input type="color" id="gradient-color3" value="#6d28d9" oninput="updateGradient()">
       </div>
      </div>
      <div class="slider-group"><label>–£–≥–æ–ª –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞: <span class="slider-value" id="angle-value">135¬∞</span></label> <input type="range" id="gradient-angle" min="0" max="360" value="135" oninput="updateGradient()">
      </div>
      <h3 style="color: #8b5cf6; margin: 2rem 0 1rem 0;">–ì–æ—Ç–æ–≤—ã–µ –ø—Ä–µ—Å–µ—Ç—ã</h3>
      <div class="preset-buttons">
       <div class="preset-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" onclick="applyPreset('#667eea', '#764ba2', '#5a67d8')">
        –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –∑–∞–∫–∞—Ç
       </div>
       <div class="preset-btn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" onclick="applyPreset('#f093fb', '#f5576c', '#fa709a')">
        –†–æ–∑–æ–≤–∞—è –º–µ—á—Ç–∞
       </div>
       <div class="preset-btn" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" onclick="applyPreset('#4facfe', '#00f2fe', '#43e97b')">
        –û–∫–µ–∞–Ω
       </div>
       <div class="preset-btn" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" onclick="applyPreset('#fa709a', '#fee140', '#ffa07a')">
        –õ–µ—Ç–Ω–∏–π –∑–∞–∫–∞—Ç
       </div>
       <div class="preset-btn" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);" onclick="applyPreset('#30cfd0', '#330867', '#5a3f9e')">
        –ö–∏–±–µ—Ä–ø–∞–Ω–∫
       </div>
       <div class="preset-btn" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);" onclick="applyPreset('#a8edea', '#fed6e3', '#d4fc79')">
        –ü–∞—Å—Ç–µ–ª—å
       </div>
      </div><button class="btn-primary" style="margin-top: 1.5rem; width: 100%;" onclick="applyGradientToSite()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≥—Ä–∞–¥–∏–µ–Ω—Ç –∫ —Å–∞–π—Ç—É</button>
     </div><!-- Visual Effects -->
     <div class="settings-section">
      <h2>‚ú® –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</h2>
      <div class="effect-toggle"><label>
        <svg style="width: 1.25rem; height: 1.25rem; color: #8b5cf6;" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle> <path d="M12 6v6l4 2" />
        </svg> –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ </label> <label class="toggle-switch"> <input type="checkbox" id="hover-animation" checked onchange="toggleEffect('hover')"> <span class="toggle-slider"></span> </label>
      </div>
      <div class="effect-toggle"><label>
        <svg style="width: 1.25rem; height: 1.25rem; color: #8b5cf6;" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
        </svg> –≠—Ñ—Ñ–µ–∫—Ç —Ä–∞–∑–º—ã—Ç–∏—è —Ñ–æ–Ω–∞ (Blur) </label> <label class="toggle-switch"> <input type="checkbox" id="blur-effect" checked onchange="toggleEffect('blur')"> <span class="toggle-slider"></span> </label>
      </div>
      <div class="effect-toggle"><label>
        <svg style="width: 1.25rem; height: 1.25rem; color: #8b5cf6;" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg> –°–≤–µ—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü —ç–ª–µ–º–µ–Ω—Ç–æ–≤ </label> <label class="toggle-switch"> <input type="checkbox" id="glow-effect" checked onchange="toggleEffect('glow')"> <span class="toggle-slider"></span> </label>
      </div>
      <div class="effect-toggle"><label>
        <svg style="width: 1.25rem; height: 1.25rem; color: #8b5cf6;" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z" />
        </svg> –¢–µ–Ω–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ </label> <label class="toggle-switch"> <input type="checkbox" id="shadow-effect" checked onchange="toggleEffect('shadow')"> <span class="toggle-slider"></span> </label>
      </div>
      <div class="slider-group"><label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞: <span class="slider-value" id="opacity-value">60%</span></label> <input type="range" id="bg-opacity" min="0" max="100" value="60" oninput="updateOpacity(this.value)">
      </div>
      <div class="slider-group"><label>–°–∫–æ—Ä–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏: <span class="slider-value" id="animation-speed-value">0.3s</span></label> <input type="range" id="animation-speed" min="1" max="10" value="3" oninput="updateAnimationSpeed(this.value)">
      </div>
     </div><!-- Advanced Role Permissions -->
     <div class="settings-section">
      <h2>üîê –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞</h2>
      <div class="permission-grid" id="permissions-grid">
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
         </div>
         <div class="permission-desc">
          –°–æ–∑–¥–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="manage_users"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏
         </div>
         <div class="permission-desc">
          –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–¥–µ—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="manage_products"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
         </div>
         <div class="permission-desc">
          –û—Ç–≤–µ—Ç—ã –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="manage_tickets"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π
         </div>
         <div class="permission-desc">
          –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ç–∏–∫–µ—Ç–∞–º –ø–æ–¥–¥–µ—Ä–∂–∫–∏
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="view_all_tickets"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
         </div>
         <div class="permission-desc">
          –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ —Ç–æ–≤–∞—Ä—ã
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="delete_products"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º
         </div>
         <div class="permission-desc">
          –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="manage_balance"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
         </div>
         <div class="permission-desc">
          –î–æ—Å—Ç—É–ø –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –∏ –æ—Ç—á—ë—Ç–∞–º
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="view_analytics"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
         </div>
         <div class="permission-desc">
          –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="moderate_content"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏
         </div>
         <div class="permission-desc">
          –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–µ–π
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="manage_roles"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –ë–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
         </div>
         <div class="permission-desc">
          –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="ban_users"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
         </div>
         <div class="permission-desc">
          –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞–¥ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="bulk_operations"> <span class="toggle-slider"></span> </label>
       </div>
       <div class="permission-card">
        <div class="permission-info">
         <div class="permission-name">
          –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
         </div>
         <div class="permission-desc">
          –í—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª—ã
         </div>
        </div><label class="toggle-switch"> <input type="checkbox" data-permission="export_data"> <span class="toggle-slider"></span> </label>
       </div>
      </div><button class="btn-primary" style="margin-top: 1.5rem; width: 100%;" onclick="savePermissions()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞</button>
     </div><!-- Theme Settings -->
     <div class="settings-section">
      <h2>üåô –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã</h2>
      <div class="color-picker-group">
       <div class="color-picker-item"><label>–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω</label> <input type="color" id="theme-bg" value="#0a0a0f" oninput="updateTheme()">
       </div>
       <div class="color-picker-item"><label>–¶–≤–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫</label> <input type="color" id="theme-card" value="#1e1e2d" oninput="updateTheme()">
       </div>
       <div class="color-picker-item"><label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label> <input type="color" id="theme-text" value="#e0e0e0" oninput="updateTheme()">
       </div>
       <div class="color-picker-item"><label>–ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç</label> <input type="color" id="theme-accent" value="#8b5cf6" oninput="updateTheme()">
       </div>
      </div><button class="btn-primary" style="margin-top: 1rem; width: 100%;" onclick="resetTheme()">–°–±—Ä–æ—Å–∏—Ç—å —Ç–µ–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
     </div>
    </div>
   </div>
  </div><!-- Login Modal -->
  <div id="login-modal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeAuthModal()">√ó</button>
    <h2 class="modal-title" id="auth-modal-title">–í—Ö–æ–¥ –≤ DarkPay</h2>
    <form id="login-form" onsubmit="handleLogin(event)">
     <div class="form-group"><label class="form-label" for="login-username">–õ–æ–≥–∏–Ω</label> <input type="text" id="login-username" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required>
     </div>
     <div class="form-group"><label class="form-label" for="login-password">–ü–∞—Ä–æ–ª—å</label> <input type="password" id="login-password" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
     </div><button type="submit" class="btn-primary btn-full">–í–æ–π—Ç–∏</button>
    </form>
    <p style="text-align: center; margin-top: 1rem; color: #a0a0a0; font-size: 0.9rem;">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" style="color: #8b5cf6;" onclick="switchToRegister(); return false;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
   </div>
  </div><!-- Register Modal -->
  <div id="register-modal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeAuthModal()">√ó</button>
    <h2 class="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ DarkPay</h2>
    <form id="register-form" onsubmit="handleRegister(event)">
     <div class="form-group"><label class="form-label" for="register-username">–õ–æ–≥–∏–Ω</label> <input type="text" id="register-username" class="form-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω" required minlength="3">
     </div>
     <div class="form-group"><label class="form-label" for="register-password">–ü–∞—Ä–æ–ª—å</label> <input type="password" id="register-password" class="form-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" required minlength="4">
     </div>
     <div class="form-group"><label class="form-label" for="register-password-confirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label> <input type="password" id="register-password-confirm" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
     </div><button type="submit" class="btn-primary btn-full">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </form>
    <p style="text-align: center; margin-top: 1rem; color: #a0a0a0; font-size: 0.9rem;">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" style="color: #8b5cf6;" onclick="switchToLogin(); return false;">–í–æ–π—Ç–∏</a></p>
   </div>
  </div><!-- Add Product Modal -->
  <div id="add-product-modal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeAddProductModal()">√ó</button>
    <h2 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
    <form id="add-product-form" onsubmit="handleAddProduct(event)">
     <div class="form-group"><label class="form-label" for="product-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label> <input type="text" id="product-title" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: CS2 Prime –∞–∫–∫–∞—É–Ω—Ç" required>
     </div>
     <div class="form-group"><label class="form-label" for="product-price">–¶–µ–Ω–∞ ($)</label> <input type="number" id="product-price" class="form-input" placeholder="15.99" step="0.01" min="0.01" required>
     </div>
     <div class="form-group"><label class="form-label" for="product-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label> <select id="product-category" class="form-input" required> <option value="accounts">–ò–≥—Ä–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã</option> <option value="currency">–í–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞</option> <option value="items">–ü—Ä–µ–¥–º–µ—Ç—ã</option> <option value="boost">–ë—É—Å—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞</option> <option value="skins">–°–∫–∏–Ω—ã</option> <option value="services">–£—Å–ª—É–≥–∏</option> </select>
     </div>
     <div class="form-group"><label class="form-label" for="product-description">–û–ø–∏—Å–∞–Ω–∏–µ</label> <textarea id="product-description" class="form-input" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à —Ç–æ–≤–∞—Ä"></textarea>
     </div><button type="submit" class="btn-primary btn-full">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    </form>
   </div>
  </div><!-- Product Details Modal -->
  <div id="product-modal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeProductModal()">√ó</button>
    <div id="product-modal-content"></div>
   </div>
  </div><!-- Contact Seller Modal -->
  <div id="contact-modal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeContactModal()">√ó</button>
    <h2 class="modal-title">–°–≤—è–∑—å —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º</h2>
    <div id="contact-seller-name" style="color: #8b5cf6; margin-bottom: 1rem;"></div>
    <div class="chat-container" id="chat-messages"></div>
    <form id="chat-form" onsubmit="sendMessage(event)" style="margin-top: 1rem;">
     <div class="form-group"><textarea id="chat-input" class="form-input" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." required></textarea>
     </div><button type="submit" class="btn-primary btn-full">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
   </div>
  </div><!-- Ticket Details Modal -->
  <div id="ticket-modal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeTicketModal()">√ó</button>
    <h2 class="modal-title" id="ticket-modal-title">–û–±—Ä–∞—â–µ–Ω–∏–µ</h2>
    <div id="ticket-modal-content"></div>
   </div>
  </div><!-- Create Role Modal -->
  <div id="create-role-modal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeCreateRoleModal()">√ó</button>
    <h2 class="modal-title">–°–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å</h2>
    <form id="create-role-form" onsubmit="handleCreateRole(event)">
     <div class="form-group"><label class="form-label" for="role-name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏</label> <input type="text" id="role-name" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä" required>
     </div>
     <div class="form-group"><label class="form-label" for="role-color">–¶–≤–µ—Ç —Ä–æ–ª–∏</label> <input type="color" id="role-color" class="form-input" value="#8b5cf6" required>
     </div>
     <div class="form-group"><label class="form-label">–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞</label>
      <div style="display: flex; flex-direction: column; gap: 0.5rem;"><label style="display: flex; align-items: center; gap: 0.5rem; color: #e0e0e0;"> <input type="checkbox" name="permission" value="manage_users"> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ </label> <label style="display: flex; align-items: center; gap: 0.5rem; color: #e0e0e0;"> <input type="checkbox" name="permission" value="manage_products"> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ </label> <label style="display: flex; align-items: center; gap: 0.5rem; color: #e0e0e0;"> <input type="checkbox" name="permission" value="manage_tickets"> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π </label> <label style="display: flex; align-items: center; gap: 0.5rem; color: #e0e0e0;"> <input type="checkbox" name="permission" value="view_all_tickets"> –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π </label> <label style="display: flex; align-items: center; gap: 0.5rem; color: #e0e0e0;"> <input type="checkbox" name="permission" value="delete_products"> –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ </label>
      </div>
     </div><button type="submit" class="btn-primary btn-full">–°–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å</button>
    </form>
   </div>
  </div><!-- Assign Role Modal -->
  <div id="assign-role-modal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeAssignRoleModal()">√ó</button>
    <h2 class="modal-title">–ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å</h2>
    <div id="assign-role-username" style="color: #8b5cf6; margin-bottom: 1rem;"></div>
    <form id="assign-role-form" onsubmit="handleAssignRole(event)">
     <div class="form-group"><label class="form-label" for="select-role">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</label> <select id="select-role" class="form-input" required> <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å --</option> </select>
     </div><button type="submit" class="btn-primary btn-full">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
    </form>
   </div>
  </div><!-- Top Up Modal -->
  <div id="topup-modal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeTopUpModal()">√ó</button>
    <h2 class="modal-title">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</h2>
    <form id="topup-form" onsubmit="handleTopUp(event)">
     <div class="form-group"><label class="form-label" for="topup-amount">–°—É–º–º–∞ ($)</label> <input type="number" id="topup-amount" class="form-input" placeholder="10.00" step="0.01" min="1" required>
     </div><button type="submit" class="btn-primary btn-full">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
    </form>
   </div>
  </div><!-- Add Product Button (for logged in users) --> <button id="add-product-btn" class="add-product-btn" style="display: none;" onclick="openAddProductModal()">+</button> <!-- Toast Notification -->
  <div id="toast" class="toast"></div><!-- Footer -->
  <footer class="footer">
   <div class="footer-content">
    <div class="footer-section">
     <h3>–û –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ</h3><a href="#" class="footer-link">–û –Ω–∞—Å</a> <a href="#" class="footer-link">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</a> <a href="#" class="footer-link">–ü—Ä–∞–≤–∏–ª–∞</a> <a href="#" class="footer-link">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</a>
    </div>
    <div class="footer-section">
     <h3>–î–ª—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤</h3><a href="#" class="footer-link">–ù–∞—á–∞—Ç—å –ø—Ä–æ–¥–∞–≤–∞—Ç—å</a> <a href="#" class="footer-link">–ö–æ–º–∏—Å—Å–∏–∏</a> <a href="#" class="footer-link">–ì–∞–π–¥—ã</a> <a href="#" class="footer-link">FAQ</a>
    </div>
    <div class="footer-section">
     <h3>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h3><a href="#" class="footer-link">–¶–µ–Ω—Ç—Ä –ø–æ–º–æ—â–∏</a> <a href="#" class="footer-link">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a> <a href="#" class="footer-link">–°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ</a> <a href="#" class="footer-link">–°–ø–æ—Ä—ã</a>
    </div>
    <div class="footer-section">
     <h3>–°–æ–æ–±—â–µ—Å—Ç–≤–æ</h3><a href="#" class="footer-link">–§–æ—Ä—É–º</a> <a href="#" class="footer-link">–ë–ª–æ–≥</a> <a href="#" class="footer-link">Discord</a> <a href="#" class="footer-link">Telegram</a>
    </div>
   </div>
   <div class="footer-bottom">
    <p>¬© 2024 DarkPay. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</p>
   </div>
  </footer>
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
      tg.ready();
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É Telegram
      if (tg.themeParams) {
        document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#0a0a0f');
        document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#e0e0e0');
        document.documentElement.style.setProperty('--tg-theme-hint-color', tg.themeParams.hint_color || '#a0a0a0');
        document.documentElement.style.setProperty('--tg-theme-link-color', tg.themeParams.link_color || '#8b5cf6');
        document.documentElement.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color || '#8b5cf6');
        document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color || '#ffffff');
      }
    }

    // LocalStorage —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    
        // localStorage removed));
      },
      updateUserData: (username, data) => {
        const users = storage.getAllUsers();
        if (users[username]) {
          users[username] = { ...users[username], ...data };
          // localStorage removed));
        }
      },
      checkUser: (username, password) => {
        const users = storage.getAllUsers();
        return users[username] && users[username].password === password;
      },
      userExists: (username) => {
        const users = storage.getAllUsers();
        return !!users[username];
      },
      getProducts: () => JSON.parse(// localStorage removed)) || [],
      saveProducts: (products) => // localStorage removed)),
      addProduct: (product) => {
        const products = storage.getProducts();
        products.push(product);
        storage.saveProducts(products);
      },
      deleteProduct: (productId) => {
        const products = storage.getProducts();
        const filtered = products.filter(p => p.id !== productId);
        storage.saveProducts(filtered);
      },
      getTickets: () => JSON.parse(// localStorage removed)) || [],
      saveTickets: (tickets) => // localStorage removed)),
      addTicket: (ticket) => {
        const tickets = storage.getTickets();
        tickets.push(ticket);
        storage.saveTickets(tickets);
      },
      updateTicket: (ticketId, updates) => {
        const tickets = storage.getTickets();
        const index = tickets.findIndex(t => t.id === ticketId);
        if (index !== -1) {
          tickets[index] = { ...tickets[index], ...updates };
          storage.saveTickets(tickets);
        }
      },
      getRoles: () => JSON.parse(// localStorage removed)) || storage.initDefaultRoles(),
      saveRoles: (roles) => // localStorage removed)),
      addRole: (role) => {
        const roles = storage.getRoles();
        roles.push(role);
        storage.saveRoles(roles);
      },
      getDefaultRole: () => {
        const roles = storage.getRoles();
        return roles.find(r => r.id === 'user') || roles[0];
      },
      initDefaultRoles: () => {
        const defaultRoles = [
          {
            id: 'admin',
            name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
            color: '#ef4444',
            permissions: ['manage_users', 'manage_products', 'manage_tickets', 'view_all_tickets', 'delete_products']
          },
          {
            id: 'user',
            name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
            color: '#6b7280',
            permissions: []
          }
        ];
        storage.saveRoles(defaultRoles);
        return defaultRoles;
      },
      getMessages: () => JSON.parse(// localStorage removed)) || [],
      saveMessages: (messages) => // localStorage removed)),
      addMessage: (message) => {
        const messages = storage.getMessages();
        messages.push(message);
        storage.saveMessages(messages);
      }
    };

    const defaultConfig = {
      site_title: "DarkPay",
      tagline: "Secure Digital Marketplace",
      hero_title: "–ü–æ–∫—É–ø–∞–π –∏ –ø—Ä–æ–¥–∞–≤–∞–π —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã",
      hero_subtitle: "–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –¥–ª—è –∏–≥—Ä–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —É—Å–ª—É–≥",
      cta_button: "–ù–∞—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é",
      background_color: "#0a0a0f",
      surface_color: "#1e1e2d",
      text_color: "#e0e0e0",
      primary_action_color: "#8b5cf6",
      secondary_action_color: "#a0a0a0"
    };

    async function onConfigChange(config) {
      const siteTitle = config.site_title || defaultConfig.site_title;
      const heroTitle = config.hero_title || defaultConfig.hero_title;
      const heroSubtitle = config.hero_subtitle || defaultConfig.hero_subtitle;
      const ctaButton = config.cta_button || defaultConfig.cta_button;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryActionColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryActionColor = config.secondary_action_color || defaultConfig.secondary_action_color;

      document.getElementById('site-title').textContent = siteTitle;
      document.getElementById('hero-title').textContent = heroTitle;
      document.getElementById('hero-subtitle').textContent = heroSubtitle;
      document.getElementById('cta-button').textContent = ctaButton;

      document.body.style.backgroundColor = backgroundColor;
      document.body.style.color = textColor;

      const surfaceElements = document.querySelectorAll('.header, .footer, .product-card, .category-card, .search-input');
      surfaceElements.forEach(el => {
        el.style.backgroundColor = surfaceColor;
      });

      const textElements = document.querySelectorAll('.section-title, .product-title, .feature-title, .category-name, .footer-section h3');
      textElements.forEach(el => {
        el.style.color = textColor;
      });

      const primaryButtons = document.querySelectorAll('.btn-primary');
      primaryButtons.forEach(btn => {
        btn.style.background = `linear-gradient(135deg, ${primaryActionColor} 0%, ${primaryActionColor}dd 100%)`;
      });

      const secondaryLinks = document.querySelectorAll('.nav-link, .footer-link');
      secondaryLinks.forEach(link => {
        link.style.color = secondaryActionColor;
      });

      const logo = document.querySelector('.logo');
      logo.style.color = primaryActionColor;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => {
              config.surface_color = value;
              window.elementSdk.setConfig({ surface_color: value });
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => {
              config.primary_action_color = value;
              window.elementSdk.setConfig({ primary_action_color: value });
            }
          },
          {
            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
            set: (value) => {
              config.secondary_action_color = value;
              window.elementSdk.setConfig({ secondary_action_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["site_title", config.site_title || defaultConfig.site_title],
        ["tagline", config.tagline || defaultConfig.tagline],
        ["hero_title", config.hero_title || defaultConfig.hero_title],
        ["hero_subtitle", config.hero_subtitle || defaultConfig.hero_subtitle],
        ["cta_button", config.cta_button || defaultConfig.cta_button]
      ]);
    }

    // –§—É–Ω–∫—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function openLoginModal() {
      document.getElementById('login-modal').classList.add('active');
    }

    function closeAuthModal() {
      document.getElementById('login-modal').classList.remove('active');
      document.getElementById('register-modal').classList.remove('active');
    }

    function switchToRegister() {
      document.getElementById('login-modal').classList.remove('active');
      document.getElementById('register-modal').classList.add('active');
    }

    function switchToLogin() {
      document.getElementById('register-modal').classList.remove('active');
      document.getElementById('login-modal').classList.add('active');
    }

    function handleLogin(event) {
      event.preventDefault();
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value;

      if (storage.checkUser(username, password)) {
        const users = storage.getAllUsers();
        const userData = users[username];
        const roles = storage.getRoles();
        
        // –ï—Å–ª–∏ —ç—Ç–æ admin, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–∑–Ω–∞—á–∞–µ–º —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        let userRole;
        if (username === 'admin') {
          userRole = roles.find(r => r.id === 'admin');
          // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–æ–ª—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
          storage.updateUserData(username, { role: 'admin' });
        } else {
          userRole = roles.find(r => r.id === userData.role) || storage.getDefaultRole();
        }
        
        const user = {
          username: username,
          balance: userData.balance,
          role: userRole,
          transactions: userData.transactions || [],
          purchases: userData.purchases || [],
          avatar: 'üë§'
        };

        storage.setUser(user);
        closeAuthModal();
        updateAuthUI();
        showToast('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + user.username + '!');
        renderProducts();
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
        if (tg) {
          tg.sendData(JSON.stringify({
            action: 'login',
            username: username,
            role: userRole.name,
            balance: userData.balance
          }));
        }
      } else {
        showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
      }
    }

    function handleRegister(event) {
      event.preventDefault();
      const username = document.getElementById('register-username').value.trim();
      const password = document.getElementById('register-password').value;
      const passwordConfirm = document.getElementById('register-password-confirm').value;

      if (password !== passwordConfirm) {
        showToast('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
        return;
      }

      if (storage.userExists(username)) {
        showToast('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
        return;
      }

      storage.saveUser(username, password);
      
      const role = storage.getDefaultRole();
      const user = {
        username: username,
        balance: 100.00,
        role: role,
        transactions: [],
        purchases: [],
        avatar: 'üë§'
      };

      storage.setUser(user);
      closeAuthModal();
      updateAuthUI();
      showToast('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + username + '!');
      
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
      if (tg) {
        tg.sendData(JSON.stringify({
          action: 'register',
          username: username,
          balance: 100.00
        }));
      }
    }

    function handleLogout() {
      storage.removeUser();
      updateAuthUI();
      showToast('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞');
      showPage('home');
    }

    function hasPermission(permission) {
      const user = storage.getUser();
      if (!user || !user.role) return false;
      return user.role.permissions.includes(permission);
    }

    function updateAuthUI() {
      const user = storage.getUser();
      const authContainer = document.getElementById('auth-container');
      const addProductBtn = document.getElementById('add-product-btn');
      const usersNavLink = document.getElementById('users-nav-link');

      if (user) {
        const roleBadge = `<span class="role-badge" style="background: ${user.role.color};">${user.role.name}</span>`;
        authContainer.innerHTML = `
          <div class="user-menu">
            <button class="user-button" onclick="toggleDropdown(); event.stopPropagation();">
              <svg style="width: 1.25rem; height: 1.25rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              <span>${user.username}${roleBadge}</span>
            </button>
            <div id="user-dropdown" class="dropdown">
              <button class="dropdown-item" onclick="showPage('profile'); toggleDropdown();">
                <svg style="width: 1rem; height: 1rem; display: inline; margin-right: 0.5rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                –ü—Ä–æ—Ñ–∏–ª—å
              </button>
              <button class="dropdown-item" onclick="showPage('profile'); toggleDropdown();">
                <svg style="width: 1rem; height: 1rem; display: inline; margin-right: 0.5rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M12 6v6l4 2"></path>
                </svg>
                –ë–∞–ª–∞–Ω—Å: $${user.balance.toFixed(2)}
              </button>
              <button class="dropdown-item" onclick="showPage('profile'); toggleDropdown();">
                <svg style="width: 1rem; height: 1rem; display: inline; margin-right: 0.5rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="9" cy="21" r="1"></circle>
                  <circle cx="20" cy="21" r="1"></circle>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                –ú–æ–∏ –ø–æ–∫—É–ø–∫–∏
              </button>
              <button class="dropdown-item" onclick="handleLogout(); toggleDropdown();">
                <svg style="width: 1rem; height: 1rem; display: inline; margin-right: 0.5rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                  <polyline points="16 17 21 12 16 7"></polyline>
                  <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                –í—ã–π—Ç–∏
              </button>
            </div>
          </div>
        `;
        addProductBtn.style.display = 'block';
        
        if (hasPermission('manage_users')) {
          usersNavLink.style.display = 'block';
          document.getElementById('settings-nav-link').style.display = 'block';
        } else {
          usersNavLink.style.display = 'none';
          document.getElementById('settings-nav-link').style.display = 'none';
        }
      } else {
        authContainer.innerHTML = '<button class="btn-primary" onclick="openLoginModal()">–í–æ–π—Ç–∏</button>';
        addProductBtn.style.display = 'none';
        usersNavLink.style.display = 'none';
        document.getElementById('settings-nav-link').style.display = 'none';
      }
    }

    function toggleDropdown() {
      document.getElementById('user-dropdown').classList.toggle('active');
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('active');
      setTimeout(() => {
        toast.classList.remove('active');
      }, 3000);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∞–¥–º–∏–Ω–∞
    function initializeProducts() {
      const stored = storage.getProducts();
      if (stored.length === 0) {
        const defaultProducts = [
          { id: 'p1', title: 'CS2 Prime –∞–∫–∫–∞—É–Ω—Ç', price: 15.99, seller: 'admin', rating: '4.9', category: 'accounts', description: 'Prime –∞–∫–∫–∞—É–Ω—Ç —Å —Ö–æ—Ä–æ—à–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π', createdAt: Date.now() },
          { id: 'p2', title: '1000 V-Bucks Fortnite', price: 8.50, seller: 'admin', rating: '5.0', category: 'currency', description: '–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–æ–π –≤–∞–ª—é—Ç—ã', createdAt: Date.now() },
          { id: 'p3', title: 'Dota 2 Arcana –Ω–∞–±–æ—Ä', price: 24.99, seller: 'admin', rating: '4.8', category: 'items', description: '–†–µ–¥–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –≥–µ—Ä–æ–µ–≤', createdAt: Date.now() },
          { id: 'p4', title: '–ë—É—Å—Ç –¥–æ Immortal', price: 45.00, seller: 'admin', rating: '4.7', category: 'boost', description: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫–∞—á–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞', createdAt: Date.now() },
          { id: 'p5', title: 'Valorant —Å–∫–∏–Ω—ã –Ω–∞–±–æ—Ä', price: 32.00, seller: 'admin', rating: '4.9', category: 'skins', description: '–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å–∫–∏–Ω—ã –¥–ª—è –æ—Ä—É–∂–∏—è', createdAt: Date.now() },
          { id: 'p6', title: '–ü—Ä–æ–∫–∞—á–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞', price: 18.99, seller: 'admin', rating: '5.0', category: 'services', description: '–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–∫–∞—á–∫–∞ –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è', createdAt: Date.now() }
        ];
        storage.saveProducts(defaultProducts);
      }
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞
      const users = storage.getAllUsers();
      if (!users['admin']) {
        const roles = storage.getRoles();
        const adminRole = roles.find(r => r.id === 'admin');
        users['admin'] = {
          password: 'admin',
          balance: 1000.00,
          registeredAt: Date.now(),
          role: 'admin',
          transactions: [],
          purchases: []
        };
        // localStorage removed));
      }
    }

    function getCategoryIcon(category) {
      const icons = {
        accounts: '<rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect><polyline points="17 2 12 7 7 2"></polyline>',
        currency: '<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>',
        items: '<path d="M6.5 6.5l11 11M6.5 17.5l11-11M12 2L2 7l10 5 10-5-10-5z"></path>',
        boost: '<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>',
        skins: '<path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>',
        services: '<circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path>'
      };
      return icons[category] || icons.items;
    }

    let currentCategory = 'all';
    let currentSearchQuery = '';

    function renderProducts() {
      const grid = document.querySelector('.products-grid');
      if (!grid) return;
      
      grid.innerHTML = '';
      
      let products = storage.getProducts();
      
      if (currentCategory !== 'all') {
        products = products.filter(p => p.category === currentCategory);
      }
      
      if (currentSearchQuery) {
        products = products.filter(p => 
          p.title.toLowerCase().includes(currentSearchQuery.toLowerCase()) ||
          p.seller.toLowerCase().includes(currentSearchQuery.toLowerCase())
        );
      }
      
      const user = storage.getUser();
      
      products.forEach(product => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <div class="product-image" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(236, 72, 153, 0.3) 100%); display: flex; align-items: center; justify-content: center;">
            <svg style="width: 4rem; height: 4rem; color: #8b5cf6;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              ${getCategoryIcon(product.category)}
            </svg>
          </div>
          <div class="product-info">
            <div class="product-title">${product.title}</div>
            <div class="product-seller">@${product.seller}</div>
            <div class="product-footer">
              <div class="product-price">$${product.price.toFixed(2)}</div>
              <div class="product-rating">‚≠ê ${product.rating}</div>
            </div>
            ${hasPermission('delete_products') ? `
              <div class="product-actions">
                <button class="btn-danger btn-small" onclick="deleteProduct('${product.id}'); event.stopPropagation();">–£–¥–∞–ª–∏—Ç—å</button>
              </div>
            ` : ''}
          </div>
        `;
        
        card.addEventListener('click', function() {
          openProductModal(product);
        });
        
        grid.appendChild(card);
      });

      if (products.length === 0) {
        grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #a0a0a0; padding: 2rem;">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
      }
    }

    function openProductModal(product) {
      const user = storage.getUser();
      const modal = document.getElementById('product-modal');
      const content = document.getElementById('product-modal-content');
      
      content.innerHTML = `
        <h2 style="color: #e0e0e0; margin-bottom: 1rem;">${product.title}</h2>
        <div style="color: #8b5cf6; margin-bottom: 1rem;">–ü—Ä–æ–¥–∞–≤–µ—Ü: @${product.seller}</div>
        <div style="color: #a0a0a0; margin-bottom: 1rem;">${product.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</div>
        <div style="font-size: 2rem; font-weight: 700; color: #10b981; margin-bottom: 1.5rem;">$${product.price.toFixed(2)}</div>
        ${user ? `
          <div style="display: flex; gap: 1rem;">
            <button class="btn-primary" onclick="buyProduct('${product.id}')">–ö—É–ø–∏—Ç—å</button>
            <button class="btn-primary" onclick="contactSeller('${product.seller}', '${product.id}')">–°–≤—è–∑–∞—Ç—å—Å—è —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º</button>
          </div>
        ` : `
          <button class="btn-primary" onclick="closeProductModal(); openLoginModal();">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å</button>
        `}
      `;
      
      modal.classList.add('active');
    }

    function closeProductModal() {
      document.getElementById('product-modal').classList.remove('active');
    }

    function buyProduct(productId) {
      const user = storage.getUser();
      if (!user) return;
      
      const products = storage.getProducts();
      const product = products.find(p => p.id === productId);
      
      if (!product) {
        showToast('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
      }
      
      if (user.balance < product.price) {
        showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ');
        return;
      }
      
      const newBalance = user.balance - product.price;
      user.balance = newBalance;
      
      const transaction = {
        id: 't' + Date.now(),
        type: 'expense',
        amount: product.price,
        description: `–ü–æ–∫—É–ø–∫–∞: ${product.title}`,
        date: Date.now()
      };
      
      user.transactions.push(transaction);
      user.purchases.push({
        ...product,
        purchaseDate: Date.now()
      });
      
      storage.setUser(user);
      storage.updateUserData(user.username, {
        balance: newBalance,
        transactions: user.transactions,
        purchases: user.purchases
      });
      
      const users = storage.getAllUsers();
      if (users[product.seller]) {
        const sellerBalance = users[product.seller].balance + product.price;
        const sellerTransactions = users[product.seller].transactions || [];
        sellerTransactions.push({
          id: 't' + Date.now(),
          type: 'income',
          amount: product.price,
          description: `–ü—Ä–æ–¥–∞–∂–∞: ${product.title}`,
          date: Date.now()
        });
        storage.updateUserData(product.seller, {
          balance: sellerBalance,
          transactions: sellerTransactions
        });
      }
      
      closeProductModal();
      updateAuthUI();
      showToast('–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞! –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å');
      
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
      if (tg) {
        tg.sendData(JSON.stringify({
          action: 'purchase',
          product: product.title,
          price: product.price,
          seller: product.seller,
          buyer: user.username,
          newBalance: newBalance
        }));
      }
    }

    let currentChatSeller = null;
    let currentChatProduct = null;

    function contactSeller(seller, productId) {
      currentChatSeller = seller;
      currentChatProduct = productId;
      
      const modal = document.getElementById('contact-modal');
      document.getElementById('contact-seller-name').textContent = `–ß–∞—Ç —Å @${seller}`;
      
      renderChatMessages();
      
      modal.classList.add('active');
      closeProductModal();
    }

    function renderChatMessages() {
      const container = document.getElementById('chat-messages');
      const user = storage.getUser();
      const messages = storage.getMessages().filter(m => 
        (m.from === user.username && m.to === currentChatSeller && m.productId === currentChatProduct) ||
        (m.from === currentChatSeller && m.to === user.username && m.productId === currentChatProduct)
      );
      
      container.innerHTML = '';
      
      if (messages.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #a0a0a0;">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</p>';
        return;
      }
      
      messages.forEach(msg => {
        const isAdmin = msg.from === currentChatSeller;
        const div = document.createElement('div');
        div.className = `chat-message ${isAdmin ? 'admin' : ''}`;
        div.innerHTML = `
          <div class="chat-message-header">
            <span>@${msg.from}</span>
            <span>${new Date(msg.date).toLocaleString('ru-RU')}</span>
          </div>
          <div class="chat-message-body">${msg.text}</div>
        `;
        container.appendChild(div);
      });
      
      container.scrollTop = container.scrollHeight;
    }

    function sendMessage(event) {
      event.preventDefault();
      const user = storage.getUser();
      const input = document.getElementById('chat-input');
      const text = input.value.trim();
      
      if (!text) return;
      
      const message = {
        id: 'm' + Date.now(),
        from: user.username,
        to: currentChatSeller,
        productId: currentChatProduct,
        text: text,
        date: Date.now()
      };
      
      storage.addMessage(message);
      input.value = '';
      renderChatMessages();
      showToast('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
    }

    function closeContactModal() {
      document.getElementById('contact-modal').classList.remove('active');
      currentChatSeller = null;
      currentChatProduct = null;
    }

    function renderSellers() {
      const grid = document.getElementById('sellers-grid');
      if (!grid) return;
      
      const users = storage.getAllUsers();
      const sellers = Object.keys(users).map(username => ({
        username,
        ...users[username]
      }));
      
      grid.innerHTML = '';
      
      sellers.forEach(seller => {
        const products = storage.getProducts().filter(p => p.seller === seller.username);
        const roles = storage.getRoles();
        const role = roles.find(r => r.id === seller.role) || storage.getDefaultRole();
        
        const card = document.createElement('div');
        card.className = 'seller-card';
        card.innerHTML = `
          <div class="seller-header">
            <div class="seller-avatar">
              <svg style="width: 1.5rem; height: 1.5rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </div>
            <div class="seller-info">
              <h3>@${seller.username} <span class="role-badge" style="background: ${role.color};">${role.name}</span></h3>
              <p style="color: #a0a0a0; font-size: 0.9rem; margin: 0;">–ü—Ä–æ–¥–∞–≤–µ—Ü</p>
            </div>
          </div>
          <div class="seller-stats">
            <span>üì¶ –¢–æ–≤–∞—Ä–æ–≤: ${products.length}</span>
            <span>‚≠ê –†–µ–π—Ç–∏–Ω–≥: 4.8</span>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    function renderTickets() {
      const list = document.getElementById('ticket-list');
      if (!list) return;
      
      const tickets = storage.getTickets();
      const user = storage.getUser();
      
      list.innerHTML = '';
      
      const userTickets = hasPermission('view_all_tickets') ? tickets : tickets.filter(t => t.username === user.username);
      
      if (userTickets.length === 0) {
        list.innerHTML = '<p style="text-align: center; color: #a0a0a0; padding: 2rem;">–ù–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π</p>';
        return;
      }
      
      userTickets.forEach(ticket => {
        const statusNames = {
          open: '–û—Ç–∫—Ä—ã—Ç',
          under_review: '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏',
          reviewed: '–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω',
          rejected: '–û—Ç–∫–ª–æ–Ω—ë–Ω',
          fixed: '–ò—Å–ø—Ä–∞–≤–ª–µ–Ω',
          closed: '–ó–∞–∫—Ä—ã—Ç'
        };
        
        const card = document.createElement('div');
        card.className = 'ticket-card';
        card.style.cursor = 'pointer';
        card.innerHTML = `
          <div class="ticket-header">
            <div>
              <h3 style="margin: 0; color: #e0e0e0;">${ticket.subject}</h3>
              <p style="color: #a0a0a0; font-size: 0.9rem; margin: 0.25rem 0 0 0;">–û—Ç: @${ticket.username}</p>
            </div>
            <span class="ticket-status ${ticket.status}">${statusNames[ticket.status]}</span>
          </div>
          <p style="color: #a0a0a0; margin: 0.5rem 0;">${ticket.message.substring(0, 100)}${ticket.message.length > 100 ? '...' : ''}</p>
          <p style="color: #6b7280; font-size: 0.85rem; margin: 0.5rem 0 0 0;">${new Date(ticket.createdAt).toLocaleString('ru-RU')}</p>
        `;
        
        card.addEventListener('click', () => openTicketModal(ticket));
        
        list.appendChild(card);
      });
    }

    let currentTicket = null;

    function openTicketModal(ticket) {
      currentTicket = ticket;
      const modal = document.getElementById('ticket-modal');
      const title = document.getElementById('ticket-modal-title');
      const content = document.getElementById('ticket-modal-content');
      
      title.textContent = ticket.subject;
      
      const statusNames = {
        open: '–û—Ç–∫—Ä—ã—Ç',
        under_review: '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏',
        reviewed: '–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω',
        rejected: '–û—Ç–∫–ª–æ–Ω—ë–Ω',
        fixed: '–ò—Å–ø—Ä–∞–≤–ª–µ–Ω',
        closed: '–ó–∞–∫—Ä—ã—Ç'
      };
      
      content.innerHTML = `
        <div style="margin-bottom: 1rem;">
          <span class="ticket-status ${ticket.status}">${statusNames[ticket.status]}</span>
        </div>
        <div style="color: #a0a0a0; margin-bottom: 0.5rem;">–û—Ç: @${ticket.username}</div>
        <div style="color: #6b7280; font-size: 0.85rem; margin-bottom: 1rem;">${new Date(ticket.createdAt).toLocaleString('ru-RU')}</div>
        <div style="color: #e0e0e0; margin-bottom: 1.5rem; padding: 1rem; background: rgba(15, 15, 25, 0.6); border-radius: 0.5rem;">
          ${ticket.message}
        </div>
        
        ${ticket.responses && ticket.responses.length > 0 ? `
          <h3 style="color: #8b5cf6; margin-bottom: 1rem;">–û—Ç–≤–µ—Ç—ã</h3>
          <div class="chat-container" style="max-height: 300px;">
            ${ticket.responses.map(r => `
              <div class="chat-message ${r.isAdmin ? 'admin' : ''}">
                <div class="chat-message-header">
                  <span>@${r.from}</span>
                  <span>${new Date(r.date).toLocaleString('ru-RU')}</span>
                </div>
                <div class="chat-message-body">${r.text}</div>
              </div>
            `).join('')}
          </div>
        ` : ''}
        
        ${hasPermission('manage_tickets') ? `
          <form onsubmit="replyToTicket(event)" style="margin-top: 1rem;">
            <div class="form-group">
              <label class="form-label">–û—Ç–≤–µ—Ç–∏—Ç—å</label>
              <textarea id="ticket-reply" class="form-input" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..." required></textarea>
            </div>
            <button type="submit" class="btn-primary btn-full">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
          </form>
          
          <div class="form-group" style="margin-top: 1rem;">
            <label class="form-label">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</label>
            <select id="ticket-status-select" class="form-input" onchange="changeTicketStatus(this.value)">
              <option value="open" ${ticket.status === 'open' ? 'selected' : ''}>–û—Ç–∫—Ä—ã—Ç</option>
              <option value="under_review" ${ticket.status === 'under_review' ? 'selected' : ''}>–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
              <option value="reviewed" ${ticket.status === 'reviewed' ? 'selected' : ''}>–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω</option>
              <option value="rejected" ${ticket.status === 'rejected' ? 'selected' : ''}>–û—Ç–∫–ª–æ–Ω—ë–Ω</option>
              <option value="fixed" ${ticket.status === 'fixed' ? 'selected' : ''}>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω</option>
              <option value="closed" ${ticket.status === 'closed' ? 'selected' : ''}>–ó–∞–∫—Ä—ã—Ç</option>
            </select>
          </div>
        ` : ''}
      `;
      
      modal.classList.add('active');
    }

    function replyToTicket(event) {
      event.preventDefault();
      const user = storage.getUser();
      const text = document.getElementById('ticket-reply').value.trim();
      
      if (!text) return;
      
      const response = {
        from: user.username,
        text: text,
        date: Date.now(),
        isAdmin: hasPermission('manage_tickets')
      };
      
      if (!currentTicket.responses) {
        currentTicket.responses = [];
      }
      
      currentTicket.responses.push(response);
      storage.updateTicket(currentTicket.id, { responses: currentTicket.responses });
      
      showToast('–û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
      closeTicketModal();
      renderTickets();
    }

    function changeTicketStatus(newStatus) {
      storage.updateTicket(currentTicket.id, { status: newStatus });
      currentTicket.status = newStatus;
      showToast('–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞—â–µ–Ω–∏—è –∏–∑–º–µ–Ω—ë–Ω');
      closeTicketModal();
      renderTickets();
    }

    function closeTicketModal() {
      document.getElementById('ticket-modal').classList.remove('active');
      currentTicket = null;
    }

    function handleSearch() {
      const searchInput = document.querySelector('.search-input');
      currentSearchQuery = searchInput.value.trim();
      renderProducts();
      
      if (currentSearchQuery && storage.getProducts().filter(p => 
        p.title.toLowerCase().includes(currentSearchQuery.toLowerCase()) ||
        p.seller.toLowerCase().includes(currentSearchQuery.toLowerCase())
      ).length > 0) {
        showToast(`–ü–æ–∏—Å–∫: ${currentSearchQuery}`);
      }
    }

    // Settings functions
    let currentGradientType = 'linear';
    const settingsState = {
      effects: {
        hover: true,
        blur: true,
        glow: true,
        shadow: true
      }
    };

    function setGradientType(type) {
      currentGradientType = type;
      document.querySelectorAll('.gradient-type-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      updateGradient();
    }

    function updateGradient() {
      const color1 = document.getElementById('gradient-color1').value;
      const color2 = document.getElementById('gradient-color2').value;
      const color3 = document.getElementById('gradient-color3').value;
      const angle = document.getElementById('gradient-angle').value;
      
      document.getElementById('angle-value').textContent = angle + '¬∞';
      
      const preview = document.getElementById('gradient-preview');
      let gradient;
      
      if (currentGradientType === 'linear') {
        gradient = `linear-gradient(${angle}deg, ${color1} 0%, ${color2} 50%, ${color3} 100%)`;
      } else if (currentGradientType === 'radial') {
        gradient = `radial-gradient(circle, ${color1} 0%, ${color2} 50%, ${color3} 100%)`;
      } else if (currentGradientType === 'conic') {
        gradient = `conic-gradient(from ${angle}deg, ${color1} 0%, ${color2} 33%, ${color3} 66%, ${color1} 100%)`;
      }
      
      preview.style.background = gradient;
    }

    function applyPreset(color1, color2, color3) {
      document.getElementById('gradient-color1').value = color1;
      document.getElementById('gradient-color2').value = color2;
      document.getElementById('gradient-color3').value = color3;
      updateGradient();
    }

    function applyGradientToSite() {
      const color1 = document.getElementById('gradient-color1').value;
      const color2 = document.getElementById('gradient-color2').value;
      const angle = document.getElementById('gradient-angle').value;
      
      const hero = document.querySelector('.hero');
      hero.style.background = `linear-gradient(${angle}deg, ${color1}22 0%, ${color2}22 100%)`;
      
      const buttons = document.querySelectorAll('.btn-primary');
      buttons.forEach(btn => {
        btn.style.background = `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`;
      });
      
      showToast('–ì—Ä–∞–¥–∏–µ–Ω—Ç –ø—Ä–∏–º–µ–Ω—ë–Ω –∫ —Å–∞–π—Ç—É!');
    }

    function toggleEffect(effect) {
      settingsState.effects[effect] = !settingsState.effects[effect];
      
      if (effect === 'hover') {
        const cards = document.querySelectorAll('.product-card, .category-card, .seller-card');
        cards.forEach(card => {
          if (settingsState.effects.hover) {
            card.style.transition = 'all 0.3s';
          } else {
            card.style.transition = 'none';
          }
        });
      } else if (effect === 'blur') {
        const header = document.querySelector('.header');
        if (settingsState.effects.blur) {
          header.style.backdropFilter = 'blur(10px)';
        } else {
          header.style.backdropFilter = 'none';
        }
      } else if (effect === 'glow') {
        const cards = document.querySelectorAll('.product-card, .category-card');
        cards.forEach(card => {
          if (settingsState.effects.glow) {
            card.style.borderColor = 'rgba(139, 92, 246, 0.2)';
          } else {
            card.style.borderColor = 'transparent';
          }
        });
      } else if (effect === 'shadow') {
        const cards = document.querySelectorAll('.product-card, .category-card');
        cards.forEach(card => {
          if (settingsState.effects.shadow) {
            card.addEventListener('mouseenter', function() {
              this.style.boxShadow = '0 10px 30px rgba(139, 92, 246, 0.2)';
            });
            card.addEventListener('mouseleave', function() {
              this.style.boxShadow = 'none';
            });
          } else {
            card.style.boxShadow = 'none';
          }
        });
      }
    }

    function updateOpacity(value) {
      document.getElementById('opacity-value').textContent = value + '%';
      const opacity = value / 100;
      
      const sections = document.querySelectorAll('.settings-section, .product-card, .category-card, .seller-card');
      sections.forEach(section => {
        const bgColor = window.getComputedStyle(section).backgroundColor;
        const rgb = bgColor.match(/\d+/g);
        if (rgb) {
          section.style.backgroundColor = `rgba(${rgb[0]}, ${rgb[1]}, ${rgb[2]}, ${opacity})`;
        }
      });
    }

    function updateAnimationSpeed(value) {
      const speed = value / 10;
      document.getElementById('animation-speed-value').textContent = speed + 's';
      
      const animated = document.querySelectorAll('.product-card, .category-card, .btn-primary, .seller-card');
      animated.forEach(el => {
        el.style.transition = `all ${speed}s`;
      });
    }

    function savePermissions() {
      const user = storage.getUser();
      if (!user || !hasPermission('manage_roles')) {
        showToast('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π');
        return;
      }
      
      const checkboxes = document.querySelectorAll('#permissions-grid input[type="checkbox"]');
      const permissions = [];
      
      checkboxes.forEach(cb => {
        if (cb.checked) {
          permissions.push(cb.getAttribute('data-permission'));
        }
      });
      
      const roles = storage.getRoles();
      const adminRole = roles.find(r => r.id === 'admin');
      if (adminRole) {
        adminRole.permissions = permissions;
        storage.saveRoles(roles);
        showToast('–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
      }
    }

    function updateTheme() {
      const bg = document.getElementById('theme-bg').value;
      const card = document.getElementById('theme-card').value;
      const text = document.getElementById('theme-text').value;
      const accent = document.getElementById('theme-accent').value;
      
      document.body.style.backgroundColor = bg;
      document.body.style.color = text;
      
      const cards = document.querySelectorAll('.product-card, .category-card, .settings-section, .seller-card');
      cards.forEach(c => {
        c.style.backgroundColor = card + '99';
      });
      
      const accentElements = document.querySelectorAll('.logo, .section-title, h2, h3');
      accentElements.forEach(el => {
        el.style.color = accent;
      });
    }

    function resetTheme() {
      document.getElementById('theme-bg').value = '#0a0a0f';
      document.getElementById('theme-card').value = '#1e1e2d';
      document.getElementById('theme-text').value = '#e0e0e0';
      document.getElementById('theme-accent').value = '#8b5cf6';
      updateTheme();
      showToast('–¢–µ–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
    }

    function loadSettingsPermissions() {
      const user = storage.getUser();
      if (!user || !user.role) return;
      
      const checkboxes = document.querySelectorAll('#permissions-grid input[type="checkbox"]');
      checkboxes.forEach(cb => {
        const permission = cb.getAttribute('data-permission');
        cb.checked = user.role.permissions.includes(permission);
      });
    }

    function showPage(page) {
      document.getElementById('home-page').style.display = 'none';
      document.getElementById('sellers-page').style.display = 'none';
      document.getElementById('support-page').style.display = 'none';
      document.getElementById('users-page').style.display = 'none';
      document.getElementById('profile-page').style.display = 'none';
      document.getElementById('settings-page').style.display = 'none';
      
      if (page === 'home') {
        document.getElementById('home-page').style.display = 'block';
        renderProducts();
      } else if (page === 'sellers') {
        document.getElementById('sellers-page').style.display = 'block';
        renderSellers();
      } else if (page === 'support') {
        const user = storage.getUser();
        if (!user) {
          showToast('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É');
          openLoginModal();
          return;
        }
        document.getElementById('support-page').style.display = 'block';
        renderTickets();
      } else if (page === 'users') {
        if (!hasPermission('manage_users')) {
          showToast('–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ');
          return;
        }
        document.getElementById('users-page').style.display = 'block';
        renderUsersPage();
      } else if (page === 'profile') {
        const user = storage.getUser();
        if (!user) {
          showToast('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å');
          openLoginModal();
          return;
        }
        document.getElementById('profile-page').style.display = 'block';
        renderProfilePage();
      } else if (page === 'settings') {
        if (!hasPermission('manage_users')) {
          showToast('–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º');
          return;
        }
        document.getElementById('settings-page').style.display = 'block';
        loadSettingsPermissions();
      }
    }

    function renderUsersPage() {
      renderRolesList();
      renderUsersTable();
    }

    function renderRolesList() {
      const container = document.getElementById('role-list');
      const roles = storage.getRoles();
      
      container.innerHTML = '';
      
      roles.forEach(role => {
        const card = document.createElement('div');
        card.className = 'role-card';
        card.innerHTML = `
          <div class="role-header">
            <span class="role-badge" style="background: ${role.color};">${role.name}</span>
            ${role.id !== 'admin' && role.id !== 'user' ? `
              <button class="btn-danger btn-small" onclick="deleteRole('${role.id}')">–£–¥–∞–ª–∏—Ç—å</button>
            ` : ''}
          </div>
          <ul class="permissions-list">
            ${role.permissions.length > 0 ? role.permissions.map(p => {
              const permNames = {
                manage_users: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏',
                manage_products: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏',
                manage_tickets: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π',
                view_all_tickets: '–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π',
                delete_products: '–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤'
              };
              return `<li>‚úì ${permNames[p] || p}</li>`;
            }).join('') : '<li>–ù–µ—Ç –ø—Ä–∞–≤</li>'}
          </ul>
        `;
        container.appendChild(card);
      });
    }

    function renderUsersTable() {
      const tbody = document.getElementById('users-table-body');
      const users = storage.getAllUsers();
      const roles = storage.getRoles();
      
      tbody.innerHTML = '';
      
      Object.keys(users).forEach(username => {
        const userData = users[username];
        const role = roles.find(r => r.id === userData.role) || storage.getDefaultRole();
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>@${username}</td>
          <td><span class="role-badge" style="background: ${role.color};">${role.name}</span></td>
          <td>$${userData.balance.toFixed(2)}</td>
          <td>${new Date(userData.registeredAt).toLocaleDateString('ru-RU')}</td>
          <td>
            <button class="btn-primary btn-small" onclick="openAssignRoleModal('${username}')">–ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function openCreateRoleModal() {
      document.getElementById('create-role-modal').classList.add('active');
    }

    function closeCreateRoleModal() {
      document.getElementById('create-role-modal').classList.remove('active');
      document.getElementById('create-role-form').reset();
    }

    function handleCreateRole(event) {
      event.preventDefault();
      
      const name = document.getElementById('role-name').value.trim();
      const color = document.getElementById('role-color').value;
      const checkboxes = document.querySelectorAll('input[name="permission"]:checked');
      const permissions = Array.from(checkboxes).map(cb => cb.value);
      
      const role = {
        id: 'role_' + Date.now(),
        name: name,
        color: color,
        permissions: permissions
      };
      
      storage.addRole(role);
      closeCreateRoleModal();
      renderUsersPage();
      showToast('–†–æ–ª—å —Å–æ–∑–¥–∞–Ω–∞');
    }

    function deleteRole(roleId) {
      const roles = storage.getRoles();
      const filtered = roles.filter(r => r.id !== roleId);
      storage.saveRoles(filtered);
      renderUsersPage();
      showToast('–†–æ–ª—å —É–¥–∞–ª–µ–Ω–∞');
    }

    let currentAssignUsername = null;

    function openAssignRoleModal(username) {
      currentAssignUsername = username;
      document.getElementById('assign-role-username').textContent = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @${username}`;
      
      const select = document.getElementById('select-role');
      const roles = storage.getRoles();
      
      select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å --</option>';
      roles.forEach(role => {
        const option = document.createElement('option');
        option.value = role.id;
        option.textContent = role.name;
        select.appendChild(option);
      });
      
      document.getElementById('assign-role-modal').classList.add('active');
    }

    function closeAssignRoleModal() {
      document.getElementById('assign-role-modal').classList.remove('active');
      currentAssignUsername = null;
    }

    function handleAssignRole(event) {
      event.preventDefault();
      
      const roleId = document.getElementById('select-role').value;
      if (!roleId) return;
      
      storage.updateUserData(currentAssignUsername, { role: roleId });
      
      const user = storage.getUser();
      if (user && user.username === currentAssignUsername) {
        const roles = storage.getRoles();
        const newRole = roles.find(r => r.id === roleId);
        user.role = newRole;
        storage.setUser(user);
        updateAuthUI();
      }
      
      closeAssignRoleModal();
      renderUsersPage();
      showToast('–†–æ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∞');
    }

    function renderProfilePage() {
      const user = storage.getUser();
      
      document.getElementById('profile-balance').textContent = `$${user.balance.toFixed(2)}`;
      
      const transactionList = document.getElementById('transaction-list');
      transactionList.innerHTML = '';
      
      if (user.transactions.length === 0) {
        transactionList.innerHTML = '<p style="text-align: center; color: #a0a0a0;">–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</p>';
      } else {
        user.transactions.slice().reverse().forEach(t => {
          const div = document.createElement('div');
          div.className = `transaction-item ${t.type}`;
          div.innerHTML = `
            <div>
              <div style="color: #e0e0e0; font-weight: 600;">${t.description}</div>
              <div style="color: #a0a0a0; font-size: 0.85rem;">${new Date(t.date).toLocaleString('ru-RU')}</div>
            </div>
            <div style="font-weight: 700; color: ${t.type === 'income' ? '#10b981' : '#ef4444'};">
              ${t.type === 'income' ? '+' : '-'}$${t.amount.toFixed(2)}
            </div>
          `;
          transactionList.appendChild(div);
        });
      }
      
      const purchasesGrid = document.getElementById('my-purchases');
      purchasesGrid.innerHTML = '';
      
      if (user.purchases.length === 0) {
        purchasesGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #a0a0a0;">–ù–µ—Ç –ø–æ–∫—É–ø–æ–∫</p>';
      } else {
        user.purchases.forEach(product => {
          const card = document.createElement('div');
          card.className = 'product-card';
          card.innerHTML = `
            <div class="product-image" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(236, 72, 153, 0.3) 100%); display: flex; align-items: center; justify-content: center;">
              <svg style="width: 4rem; height: 4rem; color: #8b5cf6;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                ${getCategoryIcon(product.category)}
              </svg>
            </div>
            <div class="product-info">
              <div class="product-title">${product.title}</div>
              <div class="product-seller">@${product.seller}</div>
              <div style="color: #a0a0a0; font-size: 0.85rem; margin-top: 0.5rem;">
                –ö—É–ø–ª–µ–Ω–æ: ${new Date(product.purchaseDate).toLocaleDateString('ru-RU')}
              </div>
            </div>
          `;
          purchasesGrid.appendChild(card);
        });
      }
    }

    function openTopUpModal() {
      document.getElementById('topup-modal').classList.add('active');
    }

    function closeTopUpModal() {
      document.getElementById('topup-modal').classList.remove('active');
      document.getElementById('topup-form').reset();
    }

    function handleTopUp(event) {
      event.preventDefault();
      
      const amount = parseFloat(document.getElementById('topup-amount').value);
      const user = storage.getUser();
      
      const newBalance = user.balance + amount;
      user.balance = newBalance;
      
      const transaction = {
        id: 't' + Date.now(),
        type: 'income',
        amount: amount,
        description: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞',
        date: Date.now()
      };
      
      user.transactions.push(transaction);
      
      storage.setUser(user);
      storage.updateUserData(user.username, {
        balance: newBalance,
        transactions: user.transactions
      });
      
      closeTopUpModal();
      updateAuthUI();
      renderProfilePage();
      showToast(`–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ $${amount.toFixed(2)}`);
      
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
      if (tg) {
        tg.sendData(JSON.stringify({
          action: 'top_up',
          username: user.username,
          amount: amount,
          newBalance: newBalance
        }));
      }
    }

    function openAddProductModal() {
      document.getElementById('add-product-modal').classList.add('active');
    }

    function closeAddProductModal() {
      document.getElementById('add-product-modal').classList.remove('active');
      document.getElementById('add-product-form').reset();
    }

    function handleAddProduct(event) {
      event.preventDefault();
      const user = storage.getUser();
      if (!user) return;
      
      const title = document.getElementById('product-title').value;
      const price = parseFloat(document.getElementById('product-price').value);
      const category = document.getElementById('product-category').value;
      const description = document.getElementById('product-description').value;
      
      const product = {
        id: 'p' + Date.now(),
        title,
        price,
        category,
        description,
        seller: user.username,
        rating: '5.0',
        createdAt: Date.now()
      };
      
      storage.addProduct(product);
      closeAddProductModal();
      renderProducts();
      showToast('–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
      
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
      if (tg) {
        tg.sendData(JSON.stringify({
          action: 'add_product',
          product: title,
          price: price,
          category: category,
          seller: user.username
        }));
      }
    }

    function deleteProduct(productId) {
      const confirmDiv = document.createElement('div');
      confirmDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(30, 30, 45, 0.95); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 1rem; padding: 2rem; z-index: 2000; text-align: center;';
      confirmDiv.innerHTML = `
        <h3 style="color: #e0e0e0; margin: 0 0 1rem 0;">–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?</h3>
        <div style="display: flex; gap: 1rem; justify-content: center;">
          <button class="btn-danger" onclick="this.parentElement.parentElement.remove(); storage.deleteProduct('${productId}'); renderProducts(); showToast('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω');">–£–¥–∞–ª–∏—Ç—å</button>
          <button class="btn-primary" onclick="this.parentElement.parentElement.remove();">–û—Ç–º–µ–Ω–∞</button>
        </div>
      `;
      document.body.appendChild(confirmDiv);
    }

    function submitTicket(event) {
      event.preventDefault();
      const user = storage.getUser();
      if (!user) return;
      
      const subject = document.getElementById('ticket-subject').value;
      const message = document.getElementById('ticket-message').value;
      
      const ticket = {
        id: 't' + Date.now(),
        username: user.username,
        subject,
        message,
        status: 'open',
        responses: [],
        createdAt: Date.now()
      };
      
      storage.addTicket(ticket);
      document.getElementById('support-form').reset();
      renderTickets();
      showToast('–û–±—Ä–∞—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
      
      // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
      if (tg) {
        tg.sendData(JSON.stringify({
          action: 'support_ticket',
          username: user.username,
          subject: subject,
          message: message
        }));
      }
    }

    document.getElementById('login-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeAuthModal();
      }
    });

    document.getElementById('register-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeAuthModal();
      }
    });

    document.addEventListener('click', function(e) {
      const userMenu = document.querySelector('.user-menu');
      if (userMenu && !userMenu.contains(e.target)) {
        const dropdown = document.getElementById('user-dropdown');
        if (dropdown) {
          dropdown.classList.remove('active');
        }
      }
    });

    // –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–µ–∂–∏–Ω–æ–∫
    function createSnowflakes() {
      const snowflakeCount = 50;
      const snowflakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ'];
      
      for (let i = 0; i < snowflakeCount; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.textContent = snowflakes[Math.floor(Math.random() * snowflakes.length)];
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 3 + 5) + 's';
        snowflake.style.animationDelay = Math.random() * 5 + 's';
        snowflake.style.fontSize = (Math.random() * 0.5 + 0.5) + 'em';
        snowflake.style.opacity = Math.random() * 0.6 + 0.4;
        document.body.appendChild(snowflake);
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      initializeProducts();
      createSnowflakes();
      
      const searchInput = document.querySelector('.search-input');
      searchInput.addEventListener('input', handleSearch);
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          handleSearch();
        }
      });

      const categoryCards = document.querySelectorAll('.category-card');
      categoryCards.forEach(card => {
        card.addEventListener('click', function() {
          const category = this.getAttribute('data-category');
          currentCategory = category;
          currentSearchQuery = '';
          searchInput.value = '';
          renderProducts();
          const categoryName = this.querySelector('.category-name').textContent;
          showToast('–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ' + categoryName);
        });
      });

      document.getElementById('cta-button').addEventListener('click', function() {
        const user = storage.getUser();
        if (!user) {
          openLoginModal();
        } else {
          openAddProductModal();
        }
      });

      document.getElementById('add-product-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeAddProductModal();
        }
      });

      document.getElementById('product-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeProductModal();
        }
      });

      document.getElementById('contact-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeContactModal();
        }
      });

      document.getElementById('ticket-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeTicketModal();
        }
      });

      document.getElementById('create-role-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeCreateRoleModal();
        }
      });

      document.getElementById('assign-role-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeAssignRoleModal();
        }
      });

      document.getElementById('topup-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeTopUpModal();
        }
      });

      updateAuthUI();
      renderProducts();
    });

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99bd93f2967a2aa2',t:'MTc2MjY5NDExNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<script>
// ---- Remote API ----
function api(action, data = {}) {
    Telegram.WebApp.sendData(JSON.stringify({ action, ...data }));
}

// ---- Storage Replacement ----
const storage = {
    getUser() { return window.__remote_user || null; },
    setUser(data) { api("set_user", { data }); window.__remote_user = data; },
    removeUser() { api("remove_user"); window.__remote_user = null; },

    getUsers() { return window.__remote_users || {}; },
    setUsers(list) { api("set_users", { list }); window.__remote_users = list; },
    getAllUsers() { return window.__remote_users || {}; },
    saveUser(u, p) {
        const users = storage.getAllUsers();
        const role = storage.getDefaultRole();
        users[u] = { password: p, balance: 100, registeredAt: Date.now(), role: role.id, transactions: [], purchases: [] };
        storage.setUsers(users);
    },
    updateUserData(username, patch) {
        api("update_user", { username, patch });
        const users = storage.getAllUsers();
        if (users[username]) { users[username] = { ...users[username], ...patch }; window.__remote_users = users; }
    },
    checkUser(u,p){ const users=storage.getAllUsers(); return users[u] && users[u].password===p; },
    userExists(u){ return !!storage.getAllUsers()[u]; },

    getProducts(){ return window.__remote_products || []; },
    addProduct(item){ api("add_product", item); const p=storage.getProducts(); p.push(item); window.__remote_products=p; },
    deleteProduct(id){ api("delete_product",{id}); window.__remote_products=storage.getProducts().filter(x=>x.id!==id); },
    updateProduct(id,data){ api("update_product",{id,data}); },

    getTickets(){ return window.__remote_tickets || []; },
    addTicket(t){ api("add_ticket",t); const arr=storage.getTickets(); arr.push(t); window.__remote_tickets=arr; },
    updateTicket(id,patch){ api("update_ticket",{id,patch}); const t=storage.getTickets(); const i=t.findIndex(x=>x.id===id); if(i!=-1){ t[i]={...t[i],...patch}; window.__remote_tickets=t;} },

    getMessages(){ return window.__remote_messages || []; },
    addMessage(m){ api("add_message",m); const mlist=storage.getMessages(); mlist.push(m); window.__remote_messages=mlist; },

    getRoles(){ return window.__remote_roles || storage.initDefaultRoles(); },
    addRole(r){ api("add_role",r); const roles=storage.getRoles(); roles.push(r); window.__remote_roles=roles; },
    updateRole(id,patch){ api("update_role",{id,patch}); },

    getDefaultRole(){ return storage.getRoles().find(r=>r.id==='user'); },
    initDefaultRoles(){
        const def=[{id:'admin',name:'–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',color:'#ef4444',permissions:['manage_users','manage_products','manage_tickets','view_all_tickets','delete_products']},
                   {id:'user',name:'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',color:'#6b7280',permissions:[]}];
        window.__remote_roles=def; return def;
    },

    setRemoteData(payload){
        if(payload.users) window.__remote_users=payload.users;
        if(payload.products) window.__remote_products=payload.products;
        if(payload.tickets) window.__remote_tickets=payload.tickets;
        if(payload.messages) window.__remote_messages=payload.messages;
        if(payload.roles) window.__remote_roles=payload.roles;
        if(payload.user) window.__remote_user=payload.user;
    }
};
</script>

</body>
</html>
